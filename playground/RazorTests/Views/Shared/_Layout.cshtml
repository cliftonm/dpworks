<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8" />
      <title>@ViewBag.Title</title>
      <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
      <script src="~/Scripts/jquery-1.9.1.min.js" type="text/javascript"></script>
      <script src="~/Scripts/bootstrap.min.js" type="text/javascript"></script>
      <link rel="stylesheet" href="~/Content/bootstrap.min.css">
      <link rel="stylesheet" href="~/Content/Site.css">
      <meta name="viewport" content="width=device-width" />
      <!-- TODO: The odd thing is, even when we include this, we still have to explicitly link the bootstrap.min.css file -->
      <!-- [at]Styles.Render("~/Content/css") --> 
      @Scripts.Render("~/bundles/modernizr")
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <a class="navbar-brand" href="#">DPW Works!</a>

        <!-- The site name is overridden when the site-wide admin is using the system and has selected a site. -->
        <!-- Otherwise, the site name is determined from the site associated with the logged in user -->
        <!-- TODO: Test: site-wide admin logs in, selects a site, logs out, user logs in -- is the ViewBag div restored? -->
        <div class="navbar-brand" id="siteName">@Session["SiteName"]</div>

        <div class="btn-group navbar-right">
            <div class="padding-top8 padding-right20">
               <button type="button" class="btn btn-default btn-topbar" onclick="location.href='@Url.Action("Index", "Home")'">Home</button>
               <button type="button" class="btn btn-default btn-topbar" onclick="location.href='@Url.Action("About", "Home")'">About</button>
               <button type="button" class="btn btn-default btn-topbar" onclick="location.href='@Url.Action("Contact", "Home")'">Contact</button>

                @if (WebSecurity.IsAuthenticated)
                {
                   <button type="button" class="btn btn-default btn-topbar" onclick="location.href='@Url.Action("Logout", "Home")'">Logout</button>
                }
             </div>
        </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">

          <!-- site-wide admin page stuff -->
            @if (WebSecurity.IsAuthenticated)
            {
              <ul class="nav nav-sidebar">
                  @if (User.IsInRole("Site-Wide Administrator"))
                  {
                    <li><a href="/Admin/SiteManagement">Sites</a></li>
                    <li><a href="/Admin/RoleManagement">Roles</a></li>
                  }
                  @if ( (User.IsInRole("Site-Wide Administrator") || User.IsInRole("Administrator")) && (Session["SiteId"] != null) )
                  {
                    <li><a href="/Admin/UserManagement">Users</a></li>
                  }
              </ul>

                <!-- separate these admin functions -->                
                if ( (User.IsInRole("Site-Wide Administrator") || User.IsInRole("Administrator")) && (Session["SiteId"] != null) )
                {
                <ul class="nav nav-sidebar">
                    <li><a href="/Admin/UnitManagement">Units</a></li>
                    <li><a href="/Admin/LaborRateManagement">Labor Rates</a></li>
                    <li><a href="/Admin/EquipmentManagement">Equipment</a></li>
                    <li><a href="/Admin/MaterialManagement">Material</a></li>
                </ul>
                }

              <!-- user stuff -->
                <!-- we see this only when we have a site selected. -->
              <ul class="nav nav-sidebar">
                <li><a href="/Estimates/NewEstimate">Create Estimate</a></li>
                <li><a href="/Estimates/ViewEstimates">View Estimates</a></li>
                <li><a href="">Reports</a></li>
                <li><a href="">Preferences</a></li>
                <li><a href="">Account Settings</a></li>
              </ul>
            }

          <!-- unregistered and registered users -->
          <ul class="nav nav-sidebar">
            <li><a href="">Report A Problem</a></li>
            <li><a href="">Contact Us</a></li>
            <li class="active"><a href="">Sign In</a></li>
          </ul>
        </div>

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
           @RenderBody()
            <!-- Needed for the default account cshtml stuff, where at the end, you find [at]section Scripts {[at]Scripts.Render("~/bundles/jqueryval") }  -->
            <!-- Must add the parameter false to indicate that the section is not required. -->
           @RenderSection("Scripts", false)
        </div>
      </div>
    </div>

    <footer>
      <div class="text-center padding-top8">&copy; @DateTime.Now.Year - dpworks.org<br />
            Developed by <a href="http://www.marcclifton.com" target="_blank">Marc Clifton</a></div>
    </footer>
  </body>
</html>
